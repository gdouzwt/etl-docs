---
layout: post
title:  "客储分析"
date:   2021-07-14 14:35:52 +0800
---

### 客储数据

#### 客储数据-日

![客储数据-日](/etl-docs/img/IMG_1768.PNG)

```sql
SELECT sum(totalReportNum) oneLevel,
       sum(totalVisitNum)  twoLevel,
       sum(reVisitNum)     reVisit,
       sum(level2p5Num)    twoPfiveLevel,
       sum(level3Num)      threeLevel
FROM jsczb_sales_mobile_day
WHERE reportDate = '2021-07-14';
```

---

#### 客储数据-周

![客储数据-周](/etl-docs/img/IMG_1769.PNG)

```sql
SELECT *
FROM (SELECT sum(totalReportNum) oneLevel,
             sum(totalVisitNum)  twoLevel,
             sum(reVisitNum)     reVisit,
             sum(level2p5Num)    twoPfiveLevel,
             sum(level3Num)      threeLevel
      FROM jsczb_sales_mobile_week
      WHERE year = '2021'
        AND week = '28') jsmw,
     (SELECT sum(reportTarget)   oneTarget,
             sum(visitTarget)    twoTarget,
             sum(reVisitTarget)  reVisitTarget,
             sum(level2p5Target) twoPfiveTarget,
             sum(level3Target)   threeTarget
      FROM jsczb_channel_target_day
      WHERE left(date, 4) = '2021'
        AND week(date, 1) = '28') tar;
```

---

#### 客储数据-月

![客储数据-月](/etl-docs/img/IMG_1770.PNG)

```sql
SELECT *
FROM (SELECT sum(totalReportNum) oneLevel,
             sum(totalVisitNum)  twoLevel,
             sum(reVisitNum)     reVisit,
             sum(level2p5Num)    twoPfiveLevel,
             sum(level3Num)      threeLevel
      FROM jsczb_sales_mobile_month
      WHERE reportMonth = '2021-07') jsmm,
     (SELECT sum(reportTarget)   oneTarget,
             sum(visitTarget)    twoTarget,
             sum(reVisitTarget)  reVisitTarget,
             sum(level2p5Target) twoPfiveTarget,
             sum(level3Target)   threeTarget
      FROM jsczb_channel_target_day
      WHERE DATE_FORMAT(date, '%Y-%m') = '2021-07') tar;
```

---

#### 客储数据-年

![客储数据-年](/etl-docs/img/IMG_1771.PNG)

```sql
SELECT *
FROM (SELECT sum(totalReportNum) oneLevel,
             sum(totalVisitNum)  twoLevel,
             sum(reVisitNum)     reVisit,
             sum(level2p5Num)    twoPfiveLevel,
             sum(level3Num)      threeLevel
      FROM jsczb_sales_mobile_year
      WHERE reportYear = '2021') jsmy,
     (SELECT sum(reportTarget)   oneTarget,
             sum(visitTarget)    twoTarget,
             sum(reVisitTarget)  reVisitTarget,
             sum(level2p5Target) twoPfiveTarget,
             sum(level3Target)   threeTarget
      FROM jsczb_channel_target_day
      WHERE left(date, 4) = '2021') tar;
```

---

#### 趋势分析-月

![趋势分析-月](/etl-docs/img/IMG_1772.PNG)

```sql
SELECT reportDate          date,
       sum(totalReportNum) oneLevel,
       sum(totalVisitNum)  twoLevel,
       sum(reVisitNum)     reVisit,
       sum(level2p5Num)    twoPfiveLevel,
       sum(level3Num)      threeLevel
FROM jsczb_sales_mobile_day
WHERE DATE_FORMAT(reportDate, '%Y-%m') = '2021-07'
GROUP BY reportDate;
```

---

#### 趋势分析-年

![趋势分析-年](/etl-docs/img/IMG_1773.PNG)

```sql
SELECT reportMonth         date,
       sum(totalReportNum) oneLevel,
       sum(totalVisitNum)  twoLevel,
       sum(reVisitNum)     reVisit,
       sum(level2p5Num)    twoPfiveLevel,
       sum(level3Num)      threeLevel
FROM jsczb_sales_mobile_month
WHERE left(reportMonth, 4) = '2021'
GROUP BY reportMonth;
```

---

### 案场转化率分析

#### 案场转化率分析-全部-月

![案场转化率分析-全部-月](/etl-docs/img/IMG_1774.PNG)

```sql
SELECT sum(totalReportNum)                                oneLevel,
       sum(reportAndVisitNum)                             twoLevel,
       sum(reportSubscribingNum)                          subscribingNum,
       sum(reportContractNum)                             contractNum,
       sum(reportAndVisitNum) / sum(totalReportNum)       oneToTwoRate,
       sum(reportSubscribingNum) / sum(reportAndVisitNum) twoToSubRate,
       sum(reportContractNum) / sum(reportSubscribingNum) subToConRate
FROM jsczb_sales_consultant_month
WHERE reportMonth = '2021-07';
```

---

#### 案场转化率分析-全部-年

![案场转化率分析-全部-年](/etl-docs/img/IMG_1775.PNG)

```sql
SELECT sum(totalReportNum)                                oneLevel,
       sum(reportAndVisitNum)                             twoLevel,
       sum(reportSubscribingNum)                          subscribingNum,
       sum(reportContractNum)                             contractNum,
       sum(reportAndVisitNum) / sum(totalReportNum)       oneToTwoRate,
       sum(reportSubscribingNum) / sum(reportAndVisitNum) twoToSubRate,
       sum(reportContractNum) / sum(reportSubscribingNum) subToConRate
FROM jsczb_sales_consultant_year
WHERE reportYear = '2021';
```

---

#### 案场转化率分析-自销-月

![案场转化率分析-自销-月](/etl-docs/img/IMG_1776.PNG)

```sql
SELECT sum(totalReportNum)                                oneLevel,
       sum(reportAndVisitNum)                             twoLevel,
       sum(reportSubscribingNum)                          subscribingNum,
       sum(reportContractNum)                             contractNum,
       sum(reportAndVisitNum) / sum(totalReportNum)       oneToTwoRate,
       sum(reportSubscribingNum) / sum(reportAndVisitNum) twoToSubRate,
       sum(reportContractNum) / sum(reportSubscribingNum) subToConRate
FROM jsczb_sales_consultant_month
WHERE reportMonth = '2021-07'
  AND saleType = '3';
```

---

#### 案场转化率分析-自销-年

![案场转化率分析-自销-年](/etl-docs/img/IMG_1777.PNG)

```sql
SELECT sum(totalReportNum)                                oneLevel,
       sum(reportAndVisitNum)                             twoLevel,
       sum(reportSubscribingNum)                          subscribingNum,
       sum(reportContractNum)                             contractNum,
       sum(reportAndVisitNum) / sum(totalReportNum)       oneToTwoRate,
       sum(reportSubscribingNum) / sum(reportAndVisitNum) twoToSubRate,
       sum(reportContractNum) / sum(reportSubscribingNum) subToConRate
FROM jsczb_sales_consultant_year
WHERE reportYear = '2021'
  AND saleType = '3';
```

---

#### 案场转化率分析-代理-月

![案场转化率分析-代理-月](/etl-docs/img/IMG_1778.PNG)

```sql
SELECT sum(totalReportNum)                                oneLevel,
       sum(reportAndVisitNum)                             twoLevel,
       sum(reportSubscribingNum)                          subscribingNum,
       sum(reportContractNum)                             contractNum,
       sum(reportAndVisitNum) / sum(totalReportNum)       oneToTwoRate,
       sum(reportSubscribingNum) / sum(reportAndVisitNum) twoToSubRate,
       sum(reportContractNum) / sum(reportSubscribingNum) subToConRate
FROM jsczb_sales_consultant_month
WHERE reportMonth = '2021-07'
  AND saleType = '4';
```

---

#### 案场转化率分析-代理-年

![案场转化率分析-代理-年](/etl-docs/img/IMG_1779.PNG)

```sql
SELECT sum(totalReportNum)                                oneLevel,
       sum(reportAndVisitNum)                             twoLevel,
       sum(reportSubscribingNum)                          subscribingNum,
       sum(reportContractNum)                             contractNum,
       sum(reportAndVisitNum) / sum(totalReportNum)       oneToTwoRate,
       sum(reportSubscribingNum) / sum(reportAndVisitNum) twoToSubRate,
       sum(reportContractNum) / sum(reportSubscribingNum) subToConRate
FROM jsczb_sales_consultant_year
WHERE reportYear = '2021'
  AND saleType = '4';
```

---

### 占比分析

#### 占比分析-渠道占比-1级-日

![占比分析-渠道占比-1级-日](/etl-docs/img/IMG_1780.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_day
                    WHERE level IN ('E', 'F', 'G')
                      AND reportDate = '2021-07-14'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_day
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportDate = '2021-07-14'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType, sum(subscribingNum) subscribingNum, sum(contractNum) contractNum
                    FROM jsczb_yixiang_tran_day
                    WHERE reportDate = '2021-07-14'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-1级-周

![占比分析-渠道占比-1级-周](/etl-docs/img/IMG_1781.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_week
                    WHERE level IN ('E', 'F', 'G')
                      AND year = '2021'
                      AND week = '28'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_week
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND year = '2021'
                      AND week = '28'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_week
                    WHERE year = '2021'
                      AND week = '28'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-1级-月

![占比分析-渠道占比-1级-月](/etl-docs/img/IMG_1782.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_month
                    WHERE level IN ('E', 'F', 'G')
                      AND reportMonth = '2021-07'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_month
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportMonth = '2021-07'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_month
                    WHERE reportMonth = '2021-07'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-1级-年

![占比分析-渠道占比-1级-年](/etl-docs/img/IMG_1783.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_year
                    WHERE level IN ('E', 'F', 'G')
                      AND reportYear = '2021'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_year
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportYear = '2021'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_year
                    WHERE reportYear = '2021'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-2级-日

![占比分析-渠道占比-2级-日](/etl-docs/img/IMG_1784.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_day
                    WHERE level IN ('E', 'F', 'G')
                      AND reportDate = '2021-07-14'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_day
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportDate = '2021-07-14'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType, sum(subscribingNum) subscribingNum, sum(contractNum) contractNum
                    FROM jsczb_yixiang_tran_day
                    WHERE reportDate = '2021-07-14'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-2级-周

![占比分析-渠道占比-2级-周](/etl-docs/img/IMG_1785.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_week
                    WHERE level IN ('E', 'F', 'G')
                      AND year = '2021'
                      AND week = '28'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_week
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND year = '2021'
                      AND week = '28'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_week
                    WHERE year = '2021'
                      AND week = '28'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-2级-月

![占比分析-渠道占比-2级-月](/etl-docs/img/IMG_1786.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_month
                    WHERE level IN ('E', 'F', 'G')
                      AND reportMonth = '2021-07'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_month
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportMonth = '2021-07'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_month
                    WHERE reportMonth = '2021-07'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-2级-年

![占比分析-渠道占比-2级-年](/etl-docs/img/IMG_1787.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_year
                    WHERE level IN ('E', 'F', 'G')
                      AND reportYear = '2021'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_year
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportYear = '2021'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_year
                    WHERE reportYear = '2021'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-认购-日

![占比分析-渠道占比-认购-日](/etl-docs/img/IMG_1788.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_day
                    WHERE level IN ('E', 'F', 'G')
                      AND reportDate = '2021-07-14'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_day
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportDate = '2021-07-14'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType, sum(subscribingNum) subscribingNum, sum(contractNum) contractNum
                    FROM jsczb_yixiang_tran_day
                    WHERE reportDate = '2021-07-14'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-认购-周

![占比分析-渠道占比-认购-周](/etl-docs/img/IMG_1789.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_week
                    WHERE level IN ('E', 'F', 'G')
                      AND year = '2021'
                      AND week = '28'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_week
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND year = '2021'
                      AND week = '28'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_week
                    WHERE year = '2021'
                      AND week = '28'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-认购-月

![占比分析-渠道占比-认购-月](/etl-docs/img/IMG_1790.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_month
                    WHERE level IN ('E', 'F', 'G')
                      AND reportMonth = '2021-07'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_month
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportMonth = '2021-07'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_month
                    WHERE reportMonth = '2021-07'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-认购-年

![占比分析-渠道占比-认购-年](/etl-docs/img/IMG_1791.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_year
                    WHERE level IN ('E', 'F', 'G')
                      AND reportYear = '2021'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_year
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportYear = '2021'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_year
                    WHERE reportYear = '2021'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-签约-日

![占比分析-渠道占比-签约-日](/etl-docs/img/IMG_1792.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_day
                    WHERE level IN ('E', 'F', 'G')
                      AND reportDate = '2021-07-14'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_day
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportDate = '2021-07-14'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType, sum(subscribingNum) subscribingNum, sum(contractNum) contractNum
                    FROM jsczb_yixiang_tran_day
                    WHERE reportDate = '2021-07-14'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-签约-周

![占比分析-渠道占比-签约-周](/etl-docs/img/IMG_1793.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_week
                    WHERE level IN ('E', 'F', 'G')
                      AND year = '2021'
                      AND week = '28'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_week
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND year = '2021'
                      AND week = '28'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_week
                    WHERE year = '2021'
                      AND week = '28'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-签约-月

![占比分析-渠道占比-签约-月](/etl-docs/img/IMG_1794.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_month
                    WHERE level IN ('E', 'F', 'G')
                      AND reportMonth = '2021-07'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_month
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportMonth = '2021-07'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_month
                    WHERE reportMonth = '2021-07'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-渠道占比-签约-年

![占比分析-渠道占比-签约-年](/etl-docs/img/IMG_1795.PNG)

```sql
SELECT jct.channel_name          name,
       ifnull(oneLevel, 0)       oneLevel,
       ifnull(twoLevel, 0)       twoLevel,
       ifnull(oneToTwo, 0)       oneToTwo,
       ifnull(twoToSub, 0)       twoToSub,
       IFNULL(subscribingNum, 0) subscribingNum,
       IFNULL(contractNum, 0)    contractNum,
       IFNULL(subToCon, 0)       subToCon
FROM jsczb_channel_type jct
         LEFT JOIN (SELECT channelType, sum(customerNum) oneLevel, sum(customeConvertNum) / sum(customerNum) oneToTwo
                    FROM jsczb_yixiang_level_year
                    WHERE level IN ('E', 'F', 'G')
                      AND reportYear = '2021'
                    GROUP BY channelType) one ON jct.channel_type = one.channelType
         LEFT JOIN (SELECT channelType, sum(customerNum) twoLevel, sum(customeConvertNum) / sum(customerNum) twoToSub
                    FROM jsczb_yixiang_level_year
                    WHERE level IN ('A', 'B', 'C', 'D')
                      AND reportYear = '2021'
                    GROUP BY channelType) two ON jct.channel_type = two.channelType
         LEFT JOIN (SELECT channelType,
                           sum(subscribingNum)                                   subscribingNum,
                           sum(contractNum)                                      contractNum,
                           sum(`subscribingContractNum`) / sum(`subscribingNum`) subToCon
                    FROM jsczb_yixiang_tran_year
                    WHERE reportYear = '2021'
                    GROUP BY channelType) sale ON sale.channelType = jct.channel_type
WHERE jct.status = 1;
```

---

#### 占比分析-意向等级占比-1级-日

![占比分析-意向等级占比-1级-日](/etl-docs/img/IMG_1796.PNG)

```sql
SELECT level                                                name,
       ifnull(sum(customerNum), 0)                          oneLevel,
       ifnull(sum(customeCOnvertNum) / sum(customerNum), 0) oneToTwo
FROM jsczb_yixiang_level_day
WHERE reportDate = '2021-07-14'
GROUP BY level;
```

---

#### 占比分析-意向等级占比-1级-周

![占比分析-意向等级占比-1级-周](/etl-docs/img/IMG_1797.PNG)

```sql
SELECT level                                                name,
       ifnull(sum(customerNum), 0)                          oneLevel,
       ifnull(sum(customeCOnvertNum) / sum(customerNum), 0) oneToTwo
FROM jsczb_yixiang_level_week
WHERE year = '2021'
  AND week = '28'
GROUP BY level;
```

---

#### 占比分析-意向等级占比-1级-月

![占比分析-意向等级占比-1级-月](/etl-docs/img/IMG_1798.PNG)

```sql
SELECT level                                                name,
       ifnull(sum(customerNum), 0)                          oneLevel,
       ifnull(sum(customeCOnvertNum) / sum(customerNum), 0) oneToTwo
FROM jsczb_yixiang_level_month
WHERE reportMonth = '2021-07'
GROUP BY level;
```

---

#### 占比分析-意向等级占比-1级-年

![占比分析-意向等级占比-1级-年](/etl-docs/img/IMG_1799.PNG)

```sql
SELECT level                                                name,
       ifnull(sum(customerNum), 0)                          oneLevel,
       ifnull(sum(customeCOnvertNum) / sum(customerNum), 0) oneToTwo
FROM jsczb_yixiang_level_year
WHERE reportYear = '2021'
GROUP BY level;
```

---

#### 占比分析-意向等级占比-2级-日

![占比分析-意向等级占比-2级-日](/etl-docs/img/IMG_1800.PNG)

```sql
SELECT level                                                name,
       ifnull(sum(customerNum), 0)                          oneLevel,
       ifnull(sum(customeCOnvertNum) / sum(customerNum), 0) oneToTwo
FROM jsczb_yixiang_level_day
WHERE reportDate = '2021-07-14'
GROUP BY level;
```

---

#### 占比分析-意向等级占比-2级-周

![占比分析-意向等级占比-2级-周](/etl-docs/img/IMG_1801.PNG)

```sql
SELECT level                                                name,
       ifnull(sum(customerNum), 0)                          oneLevel,
       ifnull(sum(customeCOnvertNum) / sum(customerNum), 0) oneToTwo
FROM jsczb_yixiang_level_week
WHERE year = '2021'
  AND week = '28'
GROUP BY level;
```

---

#### 占比分析-意向等级占比-2级-月

![占比分析-意向等级占比-2级-月](/etl-docs/img/IMG_1802.PNG)

```sql
SELECT level                                                name,
       ifnull(sum(customerNum), 0)                          oneLevel,
       ifnull(sum(customeCOnvertNum) / sum(customerNum), 0) oneToTwo
FROM jsczb_yixiang_level_month
WHERE reportMonth = '2021-07'
GROUP BY level;
```

---

#### 占比分析-意向等级占比-2级-年

![占比分析-意向等级占比-2级-年](/etl-docs/img/IMG_1803.PNG)

```sql
SELECT level                                                name,
       ifnull(sum(customerNum), 0)                          oneLevel,
       ifnull(sum(customeCOnvertNum) / sum(customerNum), 0) oneToTwo
FROM jsczb_yixiang_level_year
WHERE reportYear = '2021'
GROUP BY level;
```

---

### 渠道成交排名

#### 渠道成交排名-区域-日

![渠道成交排名-区域-日](/etl-docs/img/IMG_1804.PNG)

```sql
-- part 1
SELECT ma.areaname                                                   `name`,
       ma.areacode                                                   `code`,
       sum(a.subscribingNum)                                         sumChannelAmount,
       sum(b.subscribingNum)                                         channelAmount,
       ROUND(sum(b.subscribingNum) / sum(a.subscribingNum), 3) * 100 channelProportion,
       ROUND(0 / sum(b.subscribingNum), 2) * 100                     translateRate
FROM v_md_projectinfo mp
         LEFT JOIN (SELECT projectId, sum(subscribingNum) subscribingNum
                    FROM jsczb_sales_mobile_day
                    WHERE reportDate = '2021-07-15'
                    GROUP BY projectId) a ON mp.id_project = a.projectId
         LEFT JOIN (SELECT projectId, sum(subscribingNum) subscribingNum
                    FROM jsczb_sales_mobile_day
                    WHERE channelType = 2
                      AND reportDate = '2021-07-15'
                    GROUP BY projectId) b ON mp.id_project = b.projectId
         LEFT JOIN v_md_area ma ON mp.belong_area = ma.pk_area
GROUP BY mp.belong_area
ORDER BY channelProportion DESC, sumChannelAmount DESC;
```

```sql
-- part 2
SELECT vmp.project_name     projectName,
       vmp.project_code     projectCode,
       vmp.id_project       idProject,
       vmp.belong_area      belongArea,
       vmp.belong_provinces belongProvinces,
       vmp.belong_city      belongCity,
       vma.areaname         areaName
FROM v_md_projectinfo vmp
         LEFT JOIN v_md_area vma ON vma.areacode = vmp.belong_area
WHERE project_code IN
      (P0001, P0002, P0003, P0004, P0005, P0006, P0007, P0009, P0010, P0011, P0012, P0018, P0019, P0026, P0046, P0048, P0062, P0063, P0064, P0065, P0067, P0071, P0076, P0084, P0085, P0086, P0087, P0089, P0090, P0091, P0093, P0094, P0095, P0096, P0097, P0098, P0099, P0100,
       P0106, P0109, P0110, P0111, P0112, P0113, P0117, P0118, P0120, P0123, P0124);
```

---

#### 渠道成交排名-区域-周

![渠道成交排名-区域-周](/etl-docs/img/IMG_1805.PNG)

```sql
-- part 1
SELECT ma.areaname                                                           `name`,
       ma.areacode                                                           `code`,
       sum(a.subscribingNum)                                                 sumChannelAmount,
       sum(b.subscribingNum)                                                 channelAmount,
       ROUND(sum(b.subscribingNum) / sum(a.subscribingNum), 3) * 100         channelProportion,
       ROUND(sum(b.subscribingContractNum) / sum(b.subscribingNum), 2) * 100 translateRate
FROM v_md_projectinfo mp
         LEFT JOIN (SELECT projectId, sum(subscribingNum) subscribingNum
                    FROM jsczb_sales_mobile_week
                    WHERE `year` = LEFT(202128, 4)
                      AND week = RIGHT(202128, 2)
                    GROUP BY projectId) a ON mp.id_project = a.projectId
         LEFT JOIN (SELECT projectId,
                           sum(subscribingNum)         subscribingNum,
                           SUM(subscribingContractNum) subscribingContractNum
                    FROM jsczb_sales_mobile_week
                    WHERE channelType = 2
                      AND `year` = LEFT(202128, 4)
                      AND week = RIGHT(202128, 2)
                    GROUP BY projectId) b ON mp.id_project = b.projectId
         LEFT JOIN v_md_area ma ON mp.belong_area = ma.pk_area
GROUP BY mp.belong_area
ORDER BY channelProportion DESC, sumChannelAmount DESC;
```

```sql
-- part 2
SELECT vmp.project_name     projectName,
       vmp.project_code     projectCode,
       vmp.id_project       idProject,
       vmp.belong_area      belongArea,
       vmp.belong_provinces belongProvinces,
       vmp.belong_city      belongCity,
       vma.areaname         areaName
FROM v_md_projectinfo vmp
         LEFT JOIN v_md_area vma ON vma.areacode = vmp.belong_area
WHERE project_code IN
      (P0001, P0002, P0003, P0004, P0005, P0006, P0007, P0009, P0010, P0011, P0012, P0018, P0019, P0026, P0046, P0048, P0062, P0063, P0064, P0065, P0067, P0071, P0076, P0084, P0085, P0086, P0087, P0089, P0090, P0091, P0093, P0094, P0095, P0096, P0097, P0098, P0099, P0100,
       P0106, P0109, P0110, P0111, P0112, P0113, P0117, P0118, P0120, P0123, P0124);
```

```sql
-- unknown usage
SELECT t.md_area_code FROM md_area_uc_code t WHERE t.is_enabled = 1 AND t.uc_code IN ('10001');
```

---

#### 渠道成交排名-区域-月

![渠道成交排名-区域-月](/etl-docs/img/IMG_1806.PNG)

```sql
-- TO be filled.
```

---

#### 渠道成交排名-区域-年

![渠道成交排名-区域-年](/etl-docs/img/IMG_1807.PNG)

```sql
-- TO be filled.
```

---

#### 渠道成交排名-项目-日

![渠道成交排名-项目-日](/etl-docs/img/IMG_1808.PNG)

```sql
-- TO be filled.
```

---

#### 渠道成交排名-项目-周

![渠道成交排名-项目-周](/etl-docs/img/IMG_1809.PNG)

```sql
-- TO be filled.
```

---

#### 渠道成交排名-项目-月

![渠道成交排名-项目-月](/etl-docs/img/IMG_1810.PNG)

```sql
-- TO be filled.
```

---

#### 渠道成交排名-项目-年

![渠道成交排名-项目-年](/etl-docs/img/IMG_1811.PNG)

```sql
-- TO be filled.
```
